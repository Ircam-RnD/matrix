<!DOCTYPE html>
<html>
<head>
  <meta charset="utf-8">
  <base data-ice="baseUrl" href="../../../">
  <title data-ice="title">src/client/Space.js | API Document</title>
  <link type="text/css" rel="stylesheet" href="css/style.css">
  <link type="text/css" rel="stylesheet" href="css/prettify-tomorrow.css">
  <script src="script/prettify/prettify.js"></script>
  
  
  <script src="script/manual.js"></script>
</head>
<body class="layout-container" data-ice="rootContainer">

<header>
  <a href="./">Home</a>
  <a href="./manual/index.html" data-ice="manualHeaderLink">Manual</a>
  <a href="identifiers.html">Reference</a>
  <a href="source.html">Source</a>
  
  <a data-ice="repoURL" href="https://github.com/collective-soundworks/soundworks" class="repo-url-github">Repository</a>
  <div class="search-box">
  <span>
    <img src="./image/search.png">
    <span class="search-input-edge"></span><input class="search-input"><span class="search-input-edge"></span>
  </span>
    <ul class="search-result"></ul>
  </div>
</header>

<nav class="navigation" data-ice="nav"><div>
  <ul>
    
  <li data-ice="doc"><div data-ice="dirPath" class="nav-dir-path">client</div><span data-ice="kind" class="kind-class">C</span><span data-ice="name"><span><a href="class/src/client/Checkin.js~Checkin.html">Checkin</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-class">C</span><span data-ice="name"><span><a href="class/src/client/Control.js~Control.html">Control</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-class">C</span><span data-ice="name"><span><a href="class/src/client/Dialog.js~Dialog.html">Dialog</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-class">C</span><span data-ice="name"><span><a href="class/src/client/Filelist.js~Filelist.html">Filelist</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-class">C</span><span data-ice="name"><span><a href="class/src/client/Loader.js~Loader.html">Loader</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-class">C</span><span data-ice="name"><span><a href="class/src/client/Locator.js~Locator.html">Locator</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-class">C</span><span data-ice="name"><span><a href="class/src/client/Module.js~Module.html">Module</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-class">C</span><span data-ice="name"><span><a href="class/src/client/Orientation.js~Orientation.html">Orientation</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-class">C</span><span data-ice="name"><span><a href="class/src/client/Performance.js~Performance.html">Performance</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-class">C</span><span data-ice="name"><span><a href="class/src/client/Placer.js~Placer.html">Placer</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-class">C</span><span data-ice="name"><span><a href="class/src/client/Platform.js~Platform.html">Platform</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-class">C</span><span data-ice="name"><span><a href="class/src/client/Selector.js~Selector.html">Selector</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-class">C</span><span data-ice="name"><span><a href="class/src/client/Setup.js~Setup.html">Setup</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-class">C</span><span data-ice="name"><span><a href="class/src/client/Space.js~Space.html">Space</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-class">C</span><span data-ice="name"><span><a href="class/src/client/Sync.js~Sync.html">Sync</a></span></span></li>
<li data-ice="doc"><div data-ice="dirPath" class="nav-dir-path">server</div><span data-ice="kind" class="kind-class">C</span><span data-ice="name"><span><a href="class/src/server/Checkin.js~Checkin.html">Checkin</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-class">C</span><span data-ice="name"><span><a href="class/src/server/Client.js~Client.html">Client</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-class">C</span><span data-ice="name"><span><a href="class/src/server/Control.js~Control.html">Control</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-class">C</span><span data-ice="name"><span><a href="class/src/server/Filelist.js~FileList.html">FileList</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-class">C</span><span data-ice="name"><span><a href="class/src/server/Locator.js~Locator.html">Locator</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-class">C</span><span data-ice="name"><span><a href="class/src/server/Module.js~Module.html">Module</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-class">C</span><span data-ice="name"><span><a href="class/src/server/Performance.js~Performance.html">Performance</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-class">C</span><span data-ice="name"><span><a href="class/src/server/Placer.js~Placer.html">Placer</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-class">C</span><span data-ice="name"><span><a href="class/src/server/Setup.js~Setup.html">Setup</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-class">C</span><span data-ice="name"><span><a href="class/src/server/Sync.js~Sync.html">Sync</a></span></span></li>
</ul>
</div>
</nav>

<div class="content" data-ice="content"><h1 data-ice="title">src/client/Space.js</h1>
<pre class="source-code line-number raw-source-code"><code class="prettyprint linenums" data-ice="content">import client from &apos;./client&apos;;
import Module from &apos;./Module&apos;;

const ns = &apos;http://www.w3.org/2000/svg&apos;;

/**
 * [client] Render a {@link Setup} data graphically.
 *
 * The module never has a view (it displays the graphical representation in a `div` passed in as an argument of the {@link Space#display} method).
 *
 * The module finishes its initialization immediately.
 *
 * @example const setup = new Setup();
 * const space = new Space();
 * const container = document.getElementById(&apos;#spaceContainer&apos;);
 *
 * space.display(setup, container);
 */
export default class Space extends Module {
  /**
   * @param {Object} [options={}] Options.
   * @param {String} [options.name=&apos;space&apos;] Name of the module.
   * @param {Boolean} [options.fitContainer=false] Indicates whether the graphical representation fits the container size or not.
   * @param {Boolean} [options.listenTouchEvent=false] Indicates whether to setup a listener on the space graphical representation or not.
   */
  constructor(options = {}) {
    super(options.name ||&#xA0;&apos;space&apos;);

    /**
     * Relative width of the setup.
     * @type {Number}
     */
    this.width = 1;

    /**
     * Relative height of the setup.
     * @type {Number}
     */
    this.height = 1;

    this._fitContainer = (options.fitContainer ||&#xA0;false);
    this._listenTouchEvent = (options.listenTouchEvent || false);

    // this.spacing = 1;
    // this.labels = [];
    // this.coordinates = [];

    /**
     * Type of the setup (values currently supported: `&apos;matrix&apos;`, `&apos;surface&apos;`).
     * @type {String}
     * @todo Remove?
     */
    this.type = undefined;

    /**
     * URL of the background image (if any).
     * @type {String}
     */
    this.background = null;

    this._xFactor = 1;
    this._yFactor = 1;

    // map between shapes and their related positions
    this._shapePositionMap = [];
    this._positionIndexShapeMap = {};
  }

  // TODO note -&gt; modfiy here
  _initSetup(setup) {
    this.width = setup.width;
    this.height = setup.height;
    // this.spacing = setup.spacing;
    // this.labels = setup.labels;
    // this.coordinates = setup.coordinates;
    this.type = setup.type;
    this.background = setup.background;

    this.done();
  }

  /**
   * Start the module.
   * @private
   */
  start() {
    super.start();
    this.done();
    // client.receive(&apos;setup:init&apos;, this._onSetupInit);
    // client.send(&apos;setup:request&apos;);
  }

  /**
   * Restart the module.
   * @private
   */
  restart() {
    super.restart();
    this.done();
  }

  /**
   * Reset the module.
   * @private
   */
  reset() {
    this._shapePositionMap = [];
    this._positionIndexShapeMap = {};
    // client.removeListener(&apos;setup:init&apos;, this._onSetupInit);
    this._container.innerHTML = &apos;&apos;;
  }

  /**
   * Display a graphical representation of the setup.
   * @param {ClientSetup} setup Setup to display.
   * @param {DOMElement} container Container to append the setup representation to.
   * @param {Object} [options={}] Options.
   * @param {String} [options.transform] Indicates which transformation to aply to the representation. Possible values are:
   * - `&apos;rotate180&apos;`: rotates the representation by 180 degrees.
   * @todo Big problem with the container (_container --&gt; only one of them, while we should be able to use the display method on several containers)
   */
  display(setup, container, options = {}) {
    this._initSetup(setup);
    this._container = container;
    this._container.classList.add(&apos;space&apos;);
    this._renderingOptions = options;

    if (options.showBackground) {
      this._container.style.backgroundImage = `url(${this.background})`;
      this._container.style.backgroundPosition = &apos;50% 50%&apos;;
      this._container.style.backgroundRepeat = &apos;no-repeat&apos;;
      this._container.style.backgroundSize = &apos;contain&apos;;
    }

    const svg = document.createElementNS(ns, &apos;svg&apos;);
    const group = document.createElementNS(ns, &apos;g&apos;);

    svg.appendChild(group);
    this._container.appendChild(svg);

    this._svg = svg;
    this._group = group;

    this.resize(this._container);
  }

  /**
   * Resize the SVG element.
   */
  resize() {
    const boundingRect = this._container.getBoundingClientRect();
    const containerWidth = boundingRect.width;
    const containerHeight = boundingRect.height;
    // force adaptation to container size

    const ratio = (() =&gt; {
      return (this.width &gt; this.height) ?
        containerWidth / this.width :
        containerHeight / this.height;
    })();

    let svgWidth = this.width * ratio;
    let svgHeight = this.height * ratio;

    if (this._fitContainer) {
      svgWidth = containerWidth;
      svgHeight = containerHeight;
    }

    const offsetLeft = (containerWidth - svgWidth) / 2;
    const offsetTop = (containerHeight - svgHeight) / 2;

    this._svg.setAttributeNS(null, &apos;width&apos;, svgWidth);
    this._svg.setAttributeNS(null, &apos;height&apos;, svgHeight);
     // use setup coordinates
    this._svg.setAttributeNS(null, &apos;viewBox&apos;, `0 0 ${this.width} ${this.height}`);
    // center svg in container
    this._svg.style.position = &apos;absolute&apos;;
    this._svg.style.left = `${offsetLeft}px`;
    this._svg.style.top = `${offsetTop}px`;

    // apply rotations
    if (this._renderingOptions.transform) {
      switch (this._renderingOptions.transform) {
        case &apos;rotate180&apos;:
          this._container.setAttribute(&apos;data-xfactor&apos;, -1);
          this._container.setAttribute(&apos;data-yfactor&apos;, -1);
          // const transform = `rotate(180, ${svgWidth / 2}, ${svgHeight / 2})`;
          const transform = &apos;rotate(180, 0.5, 0.5)&apos;;
          this._group.setAttributeNS(null, &apos;transform&apos;, transform);
          break;
      }
    }

    /**
     * Left offset of the SVG element.
     * @type {Number}
     */
    this.svgOffsetLeft = offsetLeft;

    /**
     * Top offset of the SVG element.
     * @type {Number}
     */
    this.svgOffsetTop = offsetTop;

    /**
     * Width of the SVG element.
     * @type {Number}
     */
    this.svgWidth = svgWidth;

    /**
     * Height of the SVG element.
     * @type {Number}
     */
    this.svgHeight = svgHeight;

    this._ratio = ratio;
  }

  /**
   * Display an array of positions.
   * @param {Object[]} positions Positions to display.
   * @param {Number} size Size of the positions to display.
   */
  displayPositions(positions, size) {
    // clean surface
    this.removeAllPositions();

    positions.forEach((position) =&gt; {
      this.addPosition(position, size);
    });

    // add listeners
    if (this._listenTouchEvent) {
      this._container.addEventListener(&apos;touchstart&apos;, (e) =&gt; {
        e.preventDefault();
        const dots = this._shapePositionMap.map((entry) =&gt; { return entry.dot });
        let target = e.target;

        // Could probably be simplified...
        while (target !== this._container) {
          if (dots.indexOf(target) !== -1) {
            for (let i = 0; i &lt; this._shapePositionMap; i++) {
              const entry = this._shapePositionMap[i];
              if (target === entry.dot) {
                const position = entry.position;
                this.emit(&apos;select&apos;, position);
              }
            }
          }

          target = target.parentNode;
        }
      });
    }
  }

  /**
   * Adds a position to the display.
   * @param {Object} position Position to add.
   * @param {Number} size Size of the position to draw.
   */
  addPosition(position, size) {
    const radius = size / 2;
    const coordinates = position.coordinates;
    const index = position.index;

    const dot = document.createElementNS(ns, &apos;circle&apos;);
    dot.setAttributeNS(null, &apos;r&apos;, radius / this._ratio);
    dot.setAttributeNS(null, &apos;cx&apos;, coordinates[0] * this.width);
    dot.setAttributeNS(null, &apos;cy&apos;, coordinates[1] * this.height);
    dot.style.fill = &apos;steelblue&apos;;

    this._group.appendChild(dot);
    this._shapePositionMap.push({ dot, position });
    this._positionIndexShapeMap[index] = dot;
  }

  /**
   * Removes a position from the display.
   * @param {Object} position Position to remove.
   */
  removePosition(position) {
    const el = this._positionIndexShapeMap[position.index];
    this._group.removeChild(el);
  }

  /**
   * Remove all the positions displayed.
   */
  removeAllPositions() {
    while (this._group.firstChild) {
      this._group.removeChild(this._group.firstChild);
    }
  }
}
</code></pre>

</div>

<footer class="footer">
  Generated by <a href="https://esdoc.org">ESDoc<span data-ice="esdocVersion">(0.4.3)</span></a>
</footer>

<script src="script/search_index.js"></script>
<script src="script/search.js"></script>
<script src="script/pretty-print.js"></script>
<script src="script/inherited-summary.js"></script>
<script src="script/test-summary.js"></script>
<script src="script/inner-link.js"></script>
<script src="script/patch-for-local.js"></script>
</body>
</html>
