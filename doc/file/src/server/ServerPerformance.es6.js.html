<!DOCTYPE html>
<html>
<head>
  <meta charset="utf-8">
  <base data-ice="baseUrl" href="../../../">
  <title data-ice="title">src/server/ServerPerformance.es6.js | API Document</title>
  <link type="text/css" rel="stylesheet" href="css/style.css">
  <link type="text/css" rel="stylesheet" href="css/prettify-tomorrow.css">
  <script src="script/prettify/prettify.js"></script>
  
  
  <script src="script/manual.js"></script>
</head>
<body class="layout-container" data-ice="rootContainer">

<header>
  <a href="./">Home</a>
  <a href="./manual/index.html" data-ice="manualHeaderLink">Manual</a>
  <a href="identifiers.html">Reference</a>
  <a href="source.html">Source</a>
  
  <a data-ice="repoURL" href="https://github.com/collective-soundworks/soundworks" class="repo-url-github">Repository</a>
  <div class="search-box">
  <span>
    <img src="./image/search.png">
    <span class="search-input-edge"></span><input class="search-input"><span class="search-input-edge"></span>
  </span>
    <ul class="search-result"></ul>
  </div>
</header>

<nav class="navigation" data-ice="nav"><div>
  <ul>
    
  </ul>
</div>
</nav>

<div class="content" data-ice="content"><h1 data-ice="title">src/server/ServerPerformance.es6.js</h1>
<pre class="source-code line-number raw-source-code"><code class="prettyprint linenums" data-ice="content">&apos;use strict&apos;;

const ServerModule = require(&apos;./ServerModule&apos;);
// import ServerModule from &apos;./ServerModule.es6.js&apos;;

/**
 * The {@link ServerPerformance} base class constitutes a basis on which to build a performance on the server side.
 * Its particularity is to keep track of the clients who are currently in the performance with the array `this.clients`, and to have the `enter` and `exit` methods that inform the module when the client entered the performance (*i.e.* when the `performance` on the client side called its `start` method) and left it (*i.e.* when the `performance` on the client side called its `done` method, or if the client disconnected from the server).
 *
 */
class ServerPerformance extends ServerModule {
// export default class ServerPerformance extends ServerModule {
  /**
    * Creates an instance of the class.
    * @param {Object} [options={}] Options.
    * @param {string} [options.name=&apos;performance&apos;] Name of the module.
   */
  constructor(options = {}) {
    super(options.name || &apos;performance&apos;);

    /**
     * Contains the list of the clients who are currently in the performance (*i.e.* who started the performance and have not exited it yet).
     * @type {ServerClient[]}
     */
    this.clients = [];
  }

  /**
   * Called when the client connects to the server.
   * @param {ServerClient} client The connected client.
   * @private
   */
  connect(client) {
    super.connect(client);

    // Listen for the `&apos;performance:start&apos;` socket message from the client.
    client.receive(this.name + &apos;:start&apos;, () =&gt; {
      this.enter(client);
    });

    // Listen for the `&apos;performance:done&apos;` socket message from the client.
    client.receive(this.name + &apos;:done&apos;, () =&gt; {
      this.exit(client);
    });
  }

  /**
   * Called when the client disconnects from the server.
   * @param {ServerClient} client The connected client.
   * @private
   */
  disconnect(client) {
    super.disconnect(client);

    // Call the `exit` method if the client previously entered the performance.
    if (client.modules[this.name].entered)
      this.exit(client);
  }

  /**
   * Called when the client starts the performance on the client side.
   * @param {ServerClient} client The client that starts the performance.
   */
  enter(client) {
    // Add the client to the `this.clients` array.
    this.clients.push(client);

    // Set flag.
    client.modules[this.name].entered = true;
  }

  /**
   * Called when the client exits the performance on the client side (*i.e.* when the `done` method of the client side module is called, or when the client disconnects from the server).
   * @param {ServerClient} client The client that exits the performance.
   */
  exit(client) {
    // Remove the client from the `this.clients` array.
    const index = this.clients.indexOf(client);
    if (index &gt;= 0)
      this.clients.splice(index, 1);

    // Remove flag.
    client.modules[this.name].entered = false;
  }
}

module.exports = ServerPerformance;
</code></pre>

</div>

<footer class="footer">
  Generated by <a href="https://esdoc.org">ESDoc<span data-ice="esdocVersion">(0.4.3)</span></a>
</footer>

<script src="script/search_index.js"></script>
<script src="script/search.js"></script>
<script src="script/pretty-print.js"></script>
<script src="script/inherited-summary.js"></script>
<script src="script/test-summary.js"></script>
<script src="script/inner-link.js"></script>
<script src="script/patch-for-local.js"></script>
</body>
</html>
